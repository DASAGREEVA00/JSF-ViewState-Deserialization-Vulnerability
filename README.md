# JSF-ViewState-Deserialization-Vulnerability

# What is Serialization?
Serialization is the process of translating data structures or object state into a format that can be stored (for example, in a file or memory buffer) or transmitted (such as, across a network connection link) and reconstructed  later  (possibly  in  a  different  computer  environment).  It  converts  an  in-memory  data structure to a value that can be stored or transferred. This process of serializing an object is also called marshalling an object, and it is typically used when data must be moved between different parts of a computer program or from one program to another.

# What is Deserialization?
Deserialization  takes  a  series  of  bytes  and  converts  it  to  an  in-memory  data  structure  that  can  be consumed programmatically.A serialized object which was used for communication cannot be processed by a computer program; therefore, deserialization transforms theobject that was used for storage or transmission to a representation of the object that is executable.

# Vulnerability Analysis
Before diggingany deeper, we need to understand what“ViewState”is.Without state management in JSF, typically all information associated with the page and the controls on the page would be lost with each round trip.The purpose of “ViewState”is to memorize the state ofthe user, even after numerous HTTP queries (stateless  protocol). The objective is to store and restore results of users actions  that impacted the user interface of a web page (choice withindrop-down list, check-box selection, etc.).The “ViewState”of  a  page  is,  by  default,  stored  in  a  hidden  form  field  in  the  web  page  named “javax.faces.ViewState”.It worksby either saving the state in memory ofthe server and bindsit to the session,  or  serialize/deserialize  the  state  in  the  request/response  each  time. There aresome Javalibraries that accepts any serialized object without performing any checks.This allows leveragingthese libraries to execute anarbitrary code.

# ViewState Encodings
By default, “ViewState”data is stored in the page in a hidden field and is encoded using base64 encoding.“ViewState”can also be encoded as “base64 and gzip”(Base64Gzip), which starts with “H4sIAAA”. Below is a demonstration of a “ViewState”decoding processin Burp Suite.
The “ViewState”string in the first box was first decoded as Base64(second box), and then decoded as Gzipas shown in the last box. The decoding process showed the readable text “java.lang.object” and other Java related information.

# AttackRequirements
There  are  three  requirements  for  this  attack:  Burp  Suite, “Ysoserial”,  and  a  vulnerable  JSF  web application.Other  extensions  were  used  such  as  Burp  collaborator  and  Java  Deserialization  Scanner, which  are  both  available  on  the  professional  version  of  Burp  Suite.  The  Java  Deserialization  Scanner extension can also be downloadedfrom GitHub.

# References
https://github.com/frohoff/ysoserial 

https://www.exploit-db.com/docs/48126

https://github.com/federicodotta/Java-Deserialization-Scanner

https://www.synacktiv.com/ressources/JSF_ViewState_InYourFace.pdf
